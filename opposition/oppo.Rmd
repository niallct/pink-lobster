---
title: "Opposition Report"
author: "~"
date: "`r Sys.Date()`"
toc: false
toc_depth: 1
classoption: a4paper
#documentclass: cricalm
documentclass: article
output:
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
setwd("../") # the oppo report hides in a subdirectory of the main project
source("parse-tidy.R")
source("displayFuncs.R")

## load the config
library(yaml)
conf <- yaml.load_file("./config/config.yaml")
# load other packages
library(kableExtra)
library(lubridate)
# a standard font size
dfsz <- 7

# make some club-specific filtered datasets
thisclubBatAvg <- B.batAvg %>% filter(club_id %in% conf$opponents_of_interest)
thisclubBatAvg.ty <- E.batAvg.TY %>% filter(club_id %in% conf$opponents_of_interest)
thisclubBowlAvg <- B.bowlAvg %>% filter(club_id %in% conf$opponents_of_interest)
thisclubBowlAvg.ty <- E.bowlAvg.TY %>% filter(club_id %in% conf$opponents_of_interest)
thisclubInns <- B.inningses %>% filter(batting_club_id %in% conf$opponents_of_interest)
sharedMatches <- F.matches.circle %>% 
                   filter(home_club_id %in% conf$opponents_of_interest |
                          away_club_id %in% conf$opponents_of_interest )

sharedBatting <- F.batting.circle %>% 
                   filter(batting_club_id %in% conf$opponents_of_interest |
                          fielding_club_id %in% conf$opponents_of_interest ) 

sharedBowling <- F.bowling.circle %>% 
                   filter(batting_club_id %in% conf$opponents_of_interest |
                          fielding_club_id %in% conf$opponents_of_interest ) 

## the main table-displaying function
## nb the column widths get set by other functions now
D.showtable <- function(x, this_caption) {x %>%  
  kbl(longtable = T, booktabs = T, row.names = F, caption = this_caption) %>%
  kable_styling(latex_options = c("repeat_header", "striped", "hold_position"),
                font_size = dfsz) }

```

\setlength{\tabcolsep}{2pt}

```{r length, results='asis'}
if(length(conf$opponents_of_interest) > 1){
zxc <- Y.clubs %>% filter(club_id %in% conf$opponents_of_interest) %>% select(club_name) %>% pull()
cat("There is more than one club id selected. Check this is right. Names 
    associated are: ")
cat(zxc, sep=", " )
cat(".\n")
}

oppclub_name <- as.character(Y.clubs %>% filter(club_id == conf$opponents_of_interest[[1]]) %>% 
                              slice_head(n=1) %>% select(club_name))
```


---
subtitle: `r paste(oppclub_name)`
---

## Most runs
```{r mostruns}
thisclubBatAvg.ty%>%  D.batavg.mostruns("Runs scored, this year")
```

## Most wickets
Showing most wickets first
```{r mostwkts-thisyear}
thisclubBowlAvg.ty %>% D.bowlavg.wkt("Most wickets, this season")
```

## Their recent innings
```{r recent-inns}
thisclubInns %>% D.inns.recentinns("Recent opponent innings")
```

## Fifties
```{r fifties}
sharedBatting %>% D.bat.fifties2("Fifties in our matches") 
```

## Approaching batting milestones
```{r bat-ms}
thisclubBatAvg %>% D.batavg.nearms2("Approaching batting milestones")
```

## Four-fors
```{r four-fors}
sharedBowling %>% D.bowl.fourfors("Four-fors in our matches") 
```

## Approaching bowling milestones
```{r bowl-ms}
thisclubBowlAvg %>% D.bowlavg.nearbowlms2("Approaching bowling milestones")
```

## Our matches
```{r opponents}
sharedMatches %>% D.match.matchview("Our matches")
```

# Setup

## Date ranges
Data collected from Play-Cricket. 
For `r conf$club_name`, from `r B.dates$our_earliest` to `r B.dates$our_latest`,
n=`r B.dates$count_us` innings.  For all matches, from `r B.dates$all_earliest`
to `r B.dates$all_latest`, n=`r B.dates$count_all` innings.

## R session information
```{r session-info}
sessionInfo()
```
